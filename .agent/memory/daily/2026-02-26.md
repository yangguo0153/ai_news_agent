# 2026-02-26

## 执行覆盖（2026-02-26）
- 本文件中早先出现的别名入口、编码路径、临时入口相关记录仅作历史审计，不得复用到新对话。
- 新对话唯一允许的路径输出格式：原文件名（纯文本） + 单反引号包裹的原始绝对路径（纯文本）。

## 任务
- 目标：修复“聊天中点击生成文件路径无法打开”的协作体验，取消“每次任务后再临时补 `/tmp/agi-road-links/...`”的流程。

## 关键结论 1：固定 ASCII 根别名可替代按文件临时链接
- 结论：为仓库建立固定别名 `/Users/will/Desktop/agi-road -> /Users/will/Desktop/RoadToAGI` 后，可直接使用单条 ASCII 绝对路径点击文件，不再需要每个文件单独建临时链接。
- 证据：`ln -s` 创建成功；`readlink /Users/will/Desktop/agi-road` 返回真实仓库路径；`/Users/will/Desktop/agi-road/AGENTS.md`、`.../.agent/memory/INDEX.md`、`.../projects/default/MEMORY.md` 均可读且非空。
- 来源：本次命令验证（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.97

## 关键结论 2：项目协作规则已切换为“固定别名优先”
- 结论：`AGENTS.md` 交付规则已改为默认输出 `/Users/will/Desktop/agi-road/...` 单条可点击路径；`/tmp/agi-road-links/...` 改为禁用（仅别名失效时允许临时兜底并说明阻塞）。
- 证据：`git diff -- AGENTS.md` 显示新增 4 条路径规则，明确固定别名、真实路径补充条件、临时链接禁用条件。
- 来源：本次文件修改（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.98

## 变更
- 修改：`/Users/will/Desktop/RoadToAGI/AGENTS.md`
- 新增（系统链接）：`/Users/will/Desktop/agi-road`（符号链接）
- 新增：`/Users/will/Desktop/RoadToAGI/.agent/memory/daily/2026-02-26.md`

## 风险与待办
- 风险：若仓库根路径被移动或改名，`/Users/will/Desktop/agi-road` 可能失效。
- 待办：若后续出现“子路径仍含非 ASCII 且点击异常”，再评估是否为高频目录补充固定 ASCII 别名目录，而不是恢复按文件临时链接。

## 关键结论 3：空白文件的直接触发点是“短文件名点击被当作新建文件”
- 结论：截图中的 `09-人机协同试运行方案_v1.md` 在磁盘上未找到，说明点击的是“短名入口”而非真实绝对路径，编辑器在当前工作区创建了空白新文件。
- 证据：`find /Users/will/Desktop -maxdepth 4 -type f -name '09-人机协同试运行方案_v1.md'` 无结果；同批真实交付文件（如 `00-重启总纲.md`、`08-阻塞性门禁规则_v1.md`）存在于 `文案部/00-重启调研/`。
- 来源：本次排查（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.98

## 关键结论 4：已落地全局修复（跨工作区）
- 结论：已在全局配置层新增“工作区 ASCII 别名管理 + 强制绝对路径链接”策略，不再依赖单仓库规则。
- 证据：新增 `/Users/will/.codex/scripts/ensure_workspace_aliases.sh`，生成 `/Users/will/.codex/path-aliases/*` 与 `current-workspace`；更新 `/Users/will/.codex/AGENTS.md` 增加 `delivery.file_links` 规则（禁短名、默认别名、缺失先刷新别名）。
- 来源：本次实现与验证（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.97

## 变更（追加）
- 新增：`/Users/will/.codex/scripts/ensure_workspace_aliases.sh`
- 新增：`/Users/will/.codex/path-aliases/README.md`
- 修改：`/Users/will/.codex/AGENTS.md`

## 关键结论 5：空白页根因细化为“中文 label 被编码后当成本地文件名”
- 结论：点击失败并非源文件为空，而是客户端将中文链接标签编码成 `%E9...` 文件名并在当前工作区创建空白文件。
- 证据：截图标签直接出现 `08-%E9%98%BB%E5%A1%9E..._v1.md`；对应真实文件 `08-阻塞性门禁规则_v1.md` 在磁盘存在且非空（5043 字节）。
- 来源：本次复现与文件检查（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.99

## 关键结论 6：已切换为“稳定 ASCII 别名链接”机制（非临时文件）
- 结论：新增 `register_click_alias.sh`，对目标文件生成稳定 `open-<hash>.<ext>` 软链接；后续链接统一使用该别名，避免中文 label/路径触发空白页。
- 证据：执行脚本后生成 `open-7efce8e3ba.md`、`open-5c642a7cb5.md`，在 `文案部`、`agent-engineer`、`公司业务/业务文档/媒体管理系统` 三个工作区根目录均可解析到真实文件。
- 来源：本次实现与命令验证（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.98

## 变更（再次追加）
- 新增：`/Users/will/Desktop/RoadToAGI/.agent/scripts/register_click_alias.sh`
- 新增：`/Users/will/Desktop/RoadToAGI/.agent/click-alias/WORKSPACES.txt`
- 新增：`/Users/will/Desktop/RoadToAGI/.agent/click-alias/README.md`
- 新增：`/Users/will/Desktop/RoadToAGI/.agent/click-alias/INDEX.tsv`
- 修改：`/Users/will/Desktop/RoadToAGI/AGENTS.md`

## 关键结论 7：可保留原文件名展示，但点击必须走 ASCII 别名
- 结论：可满足“展示原文件名”的诉求，但不能把中文文件名直接放在可点击链接上；应采用“原文件名纯文本 + ASCII 打开链接”双轨展示。
- 证据：当链接文本/路径含中文时，客户端会出现 `%E9...` 编码名并打开空白文件；切换为 `open-<hash>.<ext>` 链接后可稳定打开真实文件。
- 来源：本次复现与验证（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.99

## 关键结论 8：报告定位已改为统一入口，不再依赖“是否生成临时文件”
- 结论：注册脚本已升级为自动生成 `REPORT_INDEX.md`，并在每个工作区根目录创建 `open-report-index.md` 入口，用户可从单一入口定位所有已注册报告。
- 证据：`文案部/open-report-index.md`、`agent-engineer/open-report-index.md`、`公司业务/业务文档/媒体管理系统/open-report-index.md` 与仓库根 `open-report-index.md` 均存在并指向同一索引文件。
- 来源：本次实现与命令验证（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.98

## 变更（最终追加）
- 修改：`/Users/will/Desktop/RoadToAGI/.agent/scripts/register_click_alias.sh`
- 新增：`/Users/will/Desktop/RoadToAGI/.agent/click-alias/REPORT_INDEX.md`
- 修改：`/Users/will/Desktop/RoadToAGI/.agent/click-alias/README.md`

## 关键结论 9：按用户要求彻底停用 ASCII 临时入口
- 结论：`open-*.md` 和 `open-report-index.md` 方案已下线，后续交付只展示/引用真实源文件路径，不再依赖 ASCII 临时文件入口。
- 证据：已删除 `.agent/scripts/register_click_alias.sh`、`.agent/click-alias/` 与各工作区 `open-*.md`、`open-report-index.md` 软链接；`AGENTS.md` 规则已改为“原路径直出”。
- 来源：本次执行（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.99

## 关键结论 10：全局兼容层改为 URL 编码路径映射
- 结论：为兼容 Codex 将中文路径编码为 `%E9...` 的行为，新增路径映射脚本，在不改原文件名的前提下让编码路径可直接命中真实文件。
- 证据：新增 `.agent/scripts/register_urlencoded_path_aliases.sh`；已创建 `/Users/will/Desktop/%E9%80%9A%E5%BE%80AGI%E4%B9%8B%E8%B7%AF` 等编码映射；使用编码绝对路径读取 `08-阻塞性门禁规则_v1.md`、`00-重启总纲.md` 均成功。
- 来源：本次实现与命令验证（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.96

## 变更（收口）
- 新增：`/Users/will/Desktop/RoadToAGI/.agent/scripts/register_urlencoded_path_aliases.sh`
- 修改：`/Users/will/Desktop/RoadToAGI/AGENTS.md`
- 修改：`/Users/will/Desktop/RoadToAGI/.agent/memory/projects/default/MEMORY.md`

## 关键结论 11：全局规则已对齐“原路径直出”
- 结论：`/Users/will/.codex/AGENTS.md` 已移除 ASCII 临时入口规则，改为默认展示原文件名和原始绝对路径，仅用兼容映射兜底客户端编码行为。
- 证据：全局 `delivery.file_links` 已更新为“原路径展示 + register_urlencoded_path_aliases 预处理 + 不暴露映射路径”。
- 来源：本次配置更新与 JSON 校验（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.97

## 变更（全局）
- 修改：`/Users/will/.codex/AGENTS.md`

## 关键结论 12：用户拒绝编码映射，方案已完全回退
- 结论：用户明确拒绝 `%E9...` 兼容映射方案；已删除映射脚本与已创建映射链接，不再在文件系统补编码路径。
- 证据：`.agent/scripts/register_urlencoded_path_aliases.sh` 已删除；`find /Users/will/Desktop/RoadToAGI -type l -name '*%*'` 结果为空；`/Users/will/Desktop/%E9%80%9A%E5%BE%80AGI%E4%B9%8B%E8%B7%AF` 已删除。
- 来源：本次回退执行（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.98

## 关键结论 13：Gemini 方案采纳为最终交付格式
- 结论：后续本地文件引用采用“原文件名 + 单反引号纯文本绝对路径”，禁止 Markdown 本地链接语法，作为规避渲染编码问题的唯一方案。
- 证据：项目 `AGENTS.md` 与全局 `~/.codex/AGENTS.md` 均已更新为该规则；ASCII 入口和编码映射规则已移除。
- 来源：本次规则收口（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.97

## 关键结论 14：/private/tmp 项目残留已清理
- 结论：已按用户确认清理 `/private/tmp` 中项目临时残留；保留系统运行项，不做全目录清空。
- 证据：删除 `agi-road-links`、`agi-road-models.json`、`kurong-ip-*`、`wechat_article*`、`alias_run.log`、`register_alias_debug.log`、`urlalias_sync.log`、`wt-cleanup-backups` 等；复核后目标清单为空，`du -sh /private/tmp` 为 `204K`。
- 来源：本次命令执行与复核（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.99

## 关键结论 15：仓库冗余热点集中在文案部历史归档
- 结论：`/Users/will/Desktop/RoadToAGI` 当前最大冗余来源是 `文案部/_archive/reset_2026-02-25/legacy_runtime/.venv`（约 319M）；其次是零散 `.DS_Store` 与历史日志/零字节文件。
- 证据：`du -h -d 3 . | sort -h | tail` 显示 `文案部/_archive/reset_2026-02-25` 319M、`文案部/_archive` 320M、仓库总量约 402M；`find . -name '.DS_Store' | wc -l` 为 24，`find . -size 0 | wc -l` 为 277。
- 来源：本次目录审计（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.99

## 关键结论 16：P0+P1 清理已执行并显著降体积
- 结论：已按用户确认执行清理（删除 `_archive/reset_2026-02-25/legacy_runtime/.venv`、全仓 `.DS_Store`、两处 `stream_debug.log`），仓库体积从约 402M 降至约 83M。
- 证据：清理后 `du -sh /Users/will/Desktop/RoadToAGI` 为 `83M`；`find ... -name '.DS_Store' | wc -l` 为 `0`；目标 `.venv` 与两处 `stream_debug.log` 路径均验证 `REMOVED`。
- 来源：本次命令执行与复核（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.99

## 关键结论 17：新会话回退的根因与修复
- 结论：`ASCII 安全入口` 回退的根因是“子工作区历史记忆仍保留旧策略”；已在规则层与记忆层双重收口为“仅原始绝对路径纯文本”。
- 证据：`agent-engineer/AGENTS.md` 已新增路径强制规则；`文案部/.agent/memory/projects/default/MEMORY.md` 已新增条目 23 覆盖历史策略；根项目 `MEMORY.md` 已新增条目 34 作为跨工作区最终策略。
- 来源：本次排查与修复（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.99

## 关键结论 18：仓库规则已收口，但对话链接渲染层仍可能输出 `%E9...`
- 结论：即使仓库和全局 `AGENTS` 都已切到“原文件名 + 纯文本绝对路径”，只要对话里仍出现可点击本地链接，客户端仍可能把中文路径 URL 编码为 `%E9...` 并跳到不存在路径，导致打开空白。
- 证据：真实文件 `文案部/00-重启调研/vnext-mvp/runs/eval/assignments/live_20260226/assignment_A.md` 存在且大小 `3950` 字节；对应编码根路径 `/Users/will/Desktop/%E9%80%9A%E5%BE%80AGI%E4%B9%8B%E8%B7%AF` 不存在；Python 检查结果 `real_exists=True`、`encoded_exists=False`。
- 来源：本次复核与命令验证（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.99

## 关键结论 19：路径记忆已整合为单一权威条目，避免后续会话混用旧策略
- 结论：路径相关执行口径已收敛为 `projects/default/MEMORY.md` 条目 37（唯一 active），历史路径条目 30/34/35/36 均改为 `superseded`；同时在根项目与 `agent-engineer` 的 `AGENTS.md` 增加“禁止本地 Markdown 链接 + 禁止裸文件名列表”硬约束。
- 证据：根项目、`agent-engineer` 与全局 `/Users/will/.codex/AGENTS.md` 均已新增限制条款；`MEMORY.md` 中条目状态已更新并新增条目 37。
- 来源：本次根治与记忆整合（2026-02-26）。
- 日期：2026-02-26
- 置信度：0.99
