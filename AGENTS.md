---
trigger: always_on
alwaysApply: true
---

# Codex 协作与记忆规则（v1）

## 目标
- 在保证交付质量的前提下，持续沉淀项目记忆，减少重复沟通成本。

## 强制流程
1. 任务开始前，读取以下文件（不存在则初始化）：
   - `.agent/memory/INDEX.md`
   - `.agent/memory/PROFILE.md`
   - `.agent/memory/projects/default/MEMORY.md`
2. 实施前先给出执行计划（步骤、文件路径、验证方式）。
3. 实施后必须验证（测试、命令结果或人工验收路径）。
4. 任务结束前，更新记忆文件（至少写入 `daily` 和 `MEMORY`）。

## 记忆写入规则
- 只记录高价值信息：事实、决策、偏好、风险与复盘。
- 每条记忆必须包含：`结论`、`证据`、`来源`、`日期`、`置信度`。
- 新结论覆盖旧结论时，标记旧结论为 `superseded`，禁止直接删除历史。
- 读取记忆时若出现冲突，只采纳“最新日期 + `status: active`”结论；`superseded` 与历史 daily 条目仅作审计，不作执行指令。
- 默认按“索引优先、按需加载”，避免全量加载记忆文件。

## Skill 协同
- 若全局可用 `memory-compound` Skill：每次任务默认执行该 Skill 流程。
- 若 Skill 未触发：按本文件中的同等流程手动完成记忆读写。

## 交付标准
- 先给结论，再给改动摘要，再给验证结果。
- 明确说明未完成项与阻塞原因，不隐藏失败。
- 报告新增/修改文件时必须给绝对路径，禁止只写 `SKILL.md` 这类短文件名。
- 交付路径只允许固定格式：先写原文件名（纯文本），下一行写单反引号包裹的原始绝对路径（纯文本）。
- 路径必须是当前真实磁盘路径，不做任何别名替换、编码替换或额外入口文件生成。
- 禁止使用任何本地 Markdown 链接语法（如 `[file](本地路径)`）或其他可点击本地链接写法。
- 禁止输出“裸文件名列表”作为交付（如 `- assignment_A.md`）；文件名必须作为纯文本说明出现。
- 历史对话与历史记忆中的其他路径格式一律视为已废弃，不再复用。
