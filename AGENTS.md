---
trigger: always_on
alwaysApply: true
---

# Codex 协作与记忆规则（v1）

## 目标
- 在保证交付质量的前提下，持续沉淀项目记忆，减少重复沟通成本。

## 强制流程
1. 任务开始前，读取以下文件（不存在则初始化）：
   - `.agent/memory/INDEX.md`
   - `.agent/memory/PROFILE.md`
   - `.agent/memory/projects/default/MEMORY.md`
2. 实施前先给出执行计划（步骤、文件路径、验证方式）。
3. 实施后必须验证（测试、命令结果或人工验收路径）。
4. 任务结束前，更新记忆文件（至少写入 `daily` 和 `MEMORY`）。

## 记忆写入规则
- 只记录高价值信息：事实、决策、偏好、风险与复盘。
- 每条记忆必须包含：`结论`、`证据`、`来源`、`日期`、`置信度`。
- 新结论覆盖旧结论时，标记旧结论为 `superseded`，禁止直接删除历史。
- 默认按“索引优先、按需加载”，避免全量加载记忆文件。

## Skill 协同
- 若全局可用 `memory-compound` Skill：每次任务默认执行该 Skill 流程。
- 若 Skill 未触发：按本文件中的同等流程手动完成记忆读写。

## 交付标准
- 先给结论，再给改动摘要，再给验证结果。
- 明确说明未完成项与阻塞原因，不隐藏失败。
- 报告新增/修改文件时必须给绝对路径（如 `/Users/.../file.md`），禁止只写 `SKILL.md` 这类短文件名。
- 给用户“可点击打开”的文件路径时，必须提供仓库内真实绝对路径；若历史消息存在短名兼容风险，需同时给根目录别名入口。
- 若工作区绝对路径包含非 ASCII 字符（如中文），优先同时提供 ASCII 安全路径（如 `/tmp/agi-road-links/...`）供点击打开。
