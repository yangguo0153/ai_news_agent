# Findings & Decisions

## 问题诊断

### 复盘报告中暴露的 4 个偏差（全部在编排层）

| #   | 偏差           | SKILL.md 中的原始表述                             | 为什么被跳过                                                            |
| --- | -------------- | ------------------------------------------------- | ----------------------------------------------------------------------- |
| 1   | 批次节奏违规   | "每 3-5 个一批，避免并发超限"                     | 写在 Step 4 的操作说明里，是"建议"语气，不是"if 违反 then 停止"的控制流 |
| 2   | 缺少审校环节   | "调用 Reviewer Agent" + "全部通过后进入 Step 5.5" | 描述性语句，模型可以"判断不需要"而跳过                                  |
| 3   | 缺少上下文交接 | "每 15 篇强制交接"                                | 只有一行描述，无阻塞机制，模型在 20 篇内完成时不会主动停                |
| 4   | 缺少审校报告   | "解析 Reviewer 返回的 JSON 质检报告"              | 审校本身被跳过，报告自然缺失                                            |

### 根因总结

所有偏差共享同一根因：**门禁写在描述层（自然语言），不在控制层（工具调用/代码）**。

当前 SKILL.md 的门禁 = "路牌"（告诉你该停，但不拦你）
需要改成 = "闸门"（物理阻断，不确认就不放行）

## 需要加入硬编码断点的位置

### 断点 1: Step 3 完成后 — 分配表确认

- **位置**: Planner 返回 JSON 并通过校验后
- **断点类型**: AskUserQuestion，展示分配表摘要，用户选择"确认继续"/"修改后重新生成"
- **不可跳过理由**: 分配表决定后续所有稿件的多样性，错了全盘返工

### 断点 2: Step 4 每批次完成后 — 批次确认

- **位置**: 每 3 篇（头条）/ 5 篇（抖音）Writer 返回后
- **断点类型**: AskUserQuestion，展示本批次成品概要，用户选择"确认并继续下一批"/"修改本批次"/"停止"
- **不可跳过理由**: 批次确认是用户中途纠偏的唯一窗口

### 断点 3: Step 5 完成后 — 审校确认

- **位置**: Reviewer 返回 JSON 质检报告后
- **断点类型**: AskUserQuestion，展示审校报告摘要（通过/返工数），用户选择"确认进入输出"/"查看详细问题"/"要求返工"
- **不可跳过理由**: 审校是最后的质量关卡

### 断点 4: 第 15 篇完成后 — 交接触发

- **位置**: 累计完成 15 篇时
- **断点类型**: AskUserQuestion，展示交接文档，用户选择"开新对话继续"/"本轮对话继续（已了解风险）"
- **不可跳过理由**: 15 篇上限是上下文质量保护

## 顶层约束设计

在 SKILL.md 最顶部加入一段"执行铁律"，用 ⛔ 标记，语气从"建议"改为"禁令"：

```
⛔ 执行铁律（违反任何一条 = 流程失败，必须重启）

1. 禁止在单次 response 中输出超过 1 个批次的成品
2. 每个 ✅ 门禁必须调用 AskUserQuestion，等待用户明确确认后才能继续
3. 禁止跳过 Step 5 Reviewer 审校
4. 第 15 篇必须触发交接流程
```

## Resources

| 文件                 | 作用                               |
| -------------------- | ---------------------------------- |
| SKILL.md             | 主要修改对象                       |
| .DEV_LOG.md          | 同步更新开发日志                   |
| 修改反馈5.0.md       | 诊断依据（复盘报告）               |
| handover-protocol.md | 交接协议（不改，但需确认引用完整） |
