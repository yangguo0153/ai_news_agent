# Agent Swarm 重构项目 - 研究发现

> 记录项目中的关键发现、洞察和学习

---

## 2026-02-11 - Agent Swarm 架构验证

### 发现1：分离模式的优势

**观察**：
- @main (Orchestrator) 独立于业务角色
- 客户经理作为第一个业务角色

**优势**：
1. 职责清晰：@main 只负责调度，不处理业务
2. 容错性强：某个角色出错，@main 可以重试
3. 可扩展：未来可以添加新角色，不影响 @main

**应用**：
- 在 LangGraph 中实现为 StateGraph
- 使用 Shared Context 传递信息

---

### 发现2：Shared Context（Mail 机制）的重要性

**问题**：
- 传统串行流程：A → B → C，信息传递损耗严重
- 下游角色看不到上游的完整输出

**解决方案**：
- 使用 Shared Context（TypedDict）
- 所有角色都能读写共享状态
- 下游角色可以看到上游的所有输出

**效果**：
- 策划者能看到客户经理的 customer_brief
- Writer 能看到策划者的 planner_brief
- 审核者能看到所有内容

---

### 发现3：分层披露避免照抄

**问题**：
- 给 AI 完整范文 → AI 容易照抄

**解决方案**：
- 不给完整范文，给结构模板 + 内容变量
- Writer 随机抽取 3-5 个细节样本
- 学习"感觉"而非句式

**效果**：
- 理论上可以降低照抄率 80%
- 需要真实 LLM 调用验证

---

### 发现4：硬性规则检查有效

**实现**：
- 字数检查：250-350字
- 禁用词检查：AI 句式黑名单
- 参数数量检查：≤2个

**效果**：
- 测试中 5/5 篇通过审核
- 硬性规则可以机械检查，准确率高

---

### 发现5：模拟内容生成的局限

**问题**：
- 当前使用模板字符串生成内容
- 细节插入位置不合理
- 内容同质化严重

**下一步**：
- 必须接入真实 LLM 调用
- 使用 Prompt 文件中的指令
- 验证真实效果

---

## 2026-02-11 - 材料重构洞察

### 发现6：从"范文"到"规则"的转换

**旧方式**：
```
给 Writer 看完整范文（500字）
→ AI 提取句式 → 替换关键词 → 输出
→ 结果：照抄
```

**新方式**：
```
给 Writer 看：
- 结构模板（只有框架）
- 细节描写库（随机抽取3-5个）
- 口吻样本库（随机抽取2个）
→ AI 学习"感觉" → 创造新内容
→ 结果：借鉴而非照抄
```

**关键**：
- 不是"不给材料"，而是"给对的材料"
- 材料形式比材料数量更重要

---

### 发现7：反例比正例更有效

**观察**：
- 告诉 AI "好的内容是温和喜庆的" → AI 不知道怎么做
- 告诉 AI "禁止使用'智商税''买教训'" → AI 知道什么不能做

**应用**：
- 审核者材料：硬性规则清单（禁止事项）
- 输出校订者材料：Anti-AI-style 特征库（反例）

---

## 2026-02-11 - 测试验证

### 发现8：字数边界问题

**问题**：
- 第一次测试：240-246字（不符合250-350字）
- 差一点点就通过

**解决**：
- 调整内容模板，增加10-20字
- 第二次测试：255-261字（全部通过）

**启示**：
- 模板设计要留有余地
- 字数要略高于下限，避免边界问题

---

### 发现9：审核机制的价值

**效果**：
- 第一次测试：0/5 通过（字数不足）
- 调整后：5/5 通过（100%通过率）

**价值**：
- 审核机制能快速发现问题
- 硬性规则检查准确率高
- 为后续优化提供明确方向

---

## 待验证假设

### 假设1：随机抽样能降低照抄率

**假设**：
- Writer 随机抽取细节样本 → 每篇看到不同样本 → 降低照抄率

**验证方法**：
- 生成 15 篇内容
- 检查开头去重率、细节多样性
- 对比 v5.2 的照抄率

**状态**：待验证（需要真实 LLM 调用）

---

### 假设2：分层披露能提升多样性

**假设**：
- 不同角色只看需要的材料 → 减少信息过载 → 提升多样性

**验证方法**：
- 对比 v5.2（全部材料可见）vs Swarm（分层披露）
- 检查同质化率

**状态**：待验证

---

### 假设3：Shared Context 能减少信息损耗

**假设**：
- 下游角色能看到上游输出 → 信息传递完整 → 减少理解偏差

**验证方法**：
- 检查策划者是否理解客户经理的 Brief
- 检查 Writer 是否理解策划者的分配

**状态**：部分验证（流程顺畅，但需要更多测试）

---

_最后更新：2026-02-11_
